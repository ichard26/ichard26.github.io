<!doctype html><html lang=en-ca dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Black 23.1a1 - please help us test the 2023 stable style! | Richard Si</title><meta name=keywords content="black,release"><meta name=description content="We just released Black 23.1a1 with the first draft of the 2023 stable style, please try it out and let us know your feedback and concerns."><meta name=author content><link rel=canonical href=https://ichard26.github.io/blog/2022/12/black-23.1a1/><link crossorigin=anonymous href=/assets/css/stylesheet.ae4dc2048190a5641880479e3fb49a6214a06b11db81d2e911734c8779d1fcb6.css integrity="sha256-rk3CBIGQpWQYgEeeP7SaYhSgaxHbgdLpEXNMh3nR/LY=" rel="preload stylesheet" as=style><link rel=icon href=https://ichard26.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ichard26.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ichard26.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ichard26.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ichard26.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script data-host=https://microanalytics.io data-dnt=true src=https://microanalytics.io/js/script.js id=ZwSg9rf6GA async defer></script><meta name=google-site-verification content="4PNzC3Db8jI_wn9D8lPdAh4B0skrLZHNbQBgVF1XtAo"><meta property="og:title" content="Black 23.1a1 - please help us test the 2023 stable style!"><meta property="og:description" content="We just released Black 23.1a1 with the first draft of the 2023 stable style, please try it out and let us know your feedback and concerns."><meta property="og:type" content="article"><meta property="og:url" content="https://ichard26.github.io/blog/2022/12/black-23.1a1/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-12-18T00:00:00-05:00"><meta property="article:modified_time" content="2023-01-03T22:30:00-05:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Black 23.1a1 - please help us test the 2023 stable style!"><meta name=twitter:description content="We just released Black 23.1a1 with the first draft of the 2023 stable style, please try it out and let us know your feedback and concerns."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://ichard26.github.io/blog/"},{"@type":"ListItem","position":2,"name":"Black 23.1a1 - please help us test the 2023 stable style!","item":"https://ichard26.github.io/blog/2022/12/black-23.1a1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Black 23.1a1 - please help us test the 2023 stable style!","name":"Black 23.1a1 - please help us test the 2023 stable style!","description":"We just released Black 23.1a1 with the first draft of the 2023 stable style, please try it out and let us know your feedback and concerns.","keywords":["black","release"],"articleBody":"As the post summary says, earlier today we released Black 23.1a1. You might be wondering why we released an alpha… it’s because the upcoming Black 23.1.0 release will see many preview code style changes promoted to the stable style.\nIn other words, Black 23.1.0 will format your code differently out of the box.\nIf you’re surprised we’re doing this, our stability policy allows us to update the stable style in the new year. This minimises disruption while keeping the door for improvements open.\n23.1a1 contains a draft of the 2023 stable style that we, the maintainers, initially decided on.\nHowever, we need your help in finalizing what goes into the 2023 stable style. If you can, please try 23.1a1 out on your codebase(s). You can install it by running this command:\npython -m pip install black==23.1a1 If you have any feedback, concerns, or run into any issues, please drop us a comment in this issue (https://github.com/psf/black/issues/3407).\nNote: Please read the start of the issue description before commenting. It will make the lives of everyone easier.\nWhat follows is brief rundown of all of the changes in the preview style that were promoted to stable in 23.1a1.\nPromoted changes Bugfixes --skip-string-normalization now prevents docstring prefixes from being normalized -S / --skip-string-normalization stops Black from normalizing string prefixes and quotes, except when it doesn’t…\nSometime ago I accidentally added a bug where Black would normalize docstring prefixes even if you told it not to, leading to this:\ndef add(a, b): - F\"\"\"Add two numbers and return the result.\"\"\" + f\"\"\"Add two numbers and return the result.\"\"\" return a + b This has been fixed in the preview style since 22.8.0 (leaving this example unchanged).\n--skip-magic-trailing-comma now removes useless trailing commas in subscripts Black has the concept of “magic trailing commas.” You can read about it here, but in essence, Black treats trailing commas as a sign that collections, calls, or function signatures should always be exploded.\n# The trailing comma will stop Black from collapsing this collection into one line. TRANSLATIONS = { \"en_us\": \"English (US)\", \"pl_pl\": \"polski\", } This can be disabled passing the -C / --skip-magic-trailing-comma flag.1\nHowever, Black didn’t remove unnecessary trailing commas in all situations. In the following example, the trailing comma in the function signature was removed as expected, but not the subscript.\nPoint = Tuple[int, int,] -def f(a: Point, b: Point,): ... +def f(a: Point, b: Point): ... This was fixed in the preview style since 22.8.0, which removes both commas as expected.\n-Point = Tuple[int, int,] +Point = Tuple[int, int] -def f(a: Point, b: Point,): ... +def f(a: Point, b: Point): ... Correctly handle trailing commas that are inside a line’s leading non-nested parens There are actually two problems in the “before” output:\nThe zero(one,).two(three,).four(five,) chain should be fully exploded The magic trailing comma in the dictionary in refresh_token() is being ignored Source:\nzero(one,).two(three,).four(five,) def refresh_token(self, device_family, refresh_token, api_key): return self.get( data={ \"refreshToken\": refresh_token, }, api_key=api_key, )[\"sdk\"][\"token\"] Before:\nzero(one,).two(three,).four( five, ) def refresh_token(self, device_family, refresh_token, api_key): return self.get(data={\"refreshToken\": refresh_token,}, api_key=api_key,)[ \"sdk\" ][\"token\"] After:\nzero( one, ).two( three, ).four( five, ) def refresh_token(self, device_family, refresh_token, api_key): return self.get( data={ \"refreshToken\": refresh_token, }, api_key=api_key, )[ \"sdk\" ][\"token\"] Both these issues have been fixed in the preview style since 22.12.0.\nEnd quotes that violate the line length limit in multiline docstrings will be moved 1 2 3 4 5 6 7 8 9 def process_and_count(text): \"\"\" Remove punctuation and return cleaned string, in addition to its length in tokens.\"\"\" pass def example_2(text): \"\"\"Remove punctuation and return cleaned string in addition to its length in tokens.\"\"\" pass Here, the third line violates the line length limit (90 \u003e 88) because of the end quotes. Earlier versions of Black would leave this be which wasn’t ideal, so now they are moved onto their own line.\ndef process_and_count(text): \"\"\" - Remove punctuation and return cleaned string, in addition to its length in tokens.\"\"\" + Remove punctuation and return cleaned string, in addition to its length in tokens. + \"\"\" pass However, Black won’t move quotes of single line docstrings (such as with example_2()) since that would look ugly.\nThis was added to the preview style in 22.8.0 and then tweaked in 23.1a1.\nBetter management of parentheses Here’s a set of changes that together improve Black’s handling of parentheses in various situations.\nOut of these five, “Remove redundant (outermost) parentheses in for statements” will probably be the most impactful.\nReturn type annotations Source:\ndef foo() -\u003e (int): return 2 def foo() -\u003e intsdfsafafafdfdsasdfsfsdfasdfafdsafdfdsfasdskdsdsfdsafdsafsdfdasfffsfdsfdsafafhdskfhdsfjdslkfdlfsdkjhsdfjkdshfkljds: return 2 def frobnicate() -\u003e ThisIsTrulyUnreasonablyExtremelyLongClassName | list[ThisIsTrulyUnreasonablyExtremelyLongClassName]: pass Before:\ndef foo() -\u003e (int): return 2 def foo() -\u003e intsdfsafafafdfdsasdfsfsdfasdfafdsafdfdsfasdskdsdsfdsafdsafsdfdasfffsfdsfdsafafhdskfhdsfjdslkfdlfsdkjhsdfjkdshfkljds: return 2 def frobnicate() -\u003e ThisIsTrulyUnreasonablyExtremelyLongClassName | list[ ThisIsTrulyUnreasonablyExtremelyLongClassName ]: pass After (22.6.0+):\ndef foo() -\u003e int: return 2 def foo() -\u003e ( intsdfsafafafdfdsasdfsfsdfasdfafdsafdfdsfasdskdsdsfdsafdsafsdfdasfffsfdsfdsafafhdskfhdsfjdslkfdlfsdkjhsdfjkdshfkljds ): return 2 def frobnicate() -\u003e ( ThisIsTrulyUnreasonablyExtremelyLongClassName | list[ThisIsTrulyUnreasonablyExtremelyLongClassName] ): pass Remove redundant parentheses around awaited objects Source:\nasync def main(): await (asyncio.sleep(1)) await (set_of_tasks | other_set) Before: unchanged.\nAfter (22.6.0+):\nasync def main(): await asyncio.sleep(1) await (set_of_tasks | other_set) Remove redundant parentheses in with statements Source:\nwith (open(\"bla.txt\")): pass with (open(\"bla.txt\")), (open(\"bla.txt\")): pass with (open(\"bla.txt\") as f): pass with (open(\"bla.txt\")) as f: pass Before: unchanged.\nAfter (22.6.0+):\nwith open(\"bla.txt\"): pass with open(\"bla.txt\"), open(\"bla.txt\"): pass with open(\"bla.txt\") as f: pass with open(\"bla.txt\") as f: pass Remove redundant parentheses from except clauses Source:\ntry: a.something except (AttributeError) as err: raise err Before: unchanged.\nAfter (22.3.0+):\ntry: a.something except AttributeError as err: raise err Remove redundant (outermost) parentheses in for statements Source:\nfor (k, v) in d.items(): print(k, v) Before: unchanged.\nAfter (22.3.0+):\nfor k, v in d.items(): print(k, v) Unfortunately, nested parentheses are still left untouched. I have an open PR to fix that, but it isn’t ready yet.\nRemove blank lines after code block open Here’s another change that is likely to impact your codebase.\nNote: This new feature will be applied to all code blocks: def, class, if, for , while, with, case and match.\nSource:\ndef foo(): print(\"All the newlines above me should be deleted!\") if condition: print(\"No newline above me!\") print(\"There is a newline above me, and that's OK!\") class Point: x: int y: int def as_tuple(self) -\u003e tuple[int, int]: return (self.x, self.y) Before:\ndef foo(): print(\"All the newlines above me should be deleted!\") if condition: print(\"No newline above me!\") print(\"There is a newline above me, and that's OK!\") class Point: x: int y: int def as_tuple(self) -\u003e tuple[int, int]: return (self.x, self.y) After (22.6.0+):\ndef foo(): print(\"All the newlines above me should be deleted!\") if condition: print(\"No newline above me!\") print(\"There is a newline above me, and that's OK!\") class Point: x: int y: int def as_tuple(self) -\u003e tuple[int, int]: return (self.x, self.y) Ignore magic trailing comma for single-element subscripts Black exempts single-element tuple literals from the usual handling of magic trailing commas: (1,) will not have a newline added (as would happen for lists, sets, etc.).\nHowever, if you wrote tuple[int,] (to make it more visually distinctive to list[int]), Black would explode it, which doesn’t look great.\nSource:\nshape: tuple[int,] shape = (1,) Before:\nshape: tuple[ int, ] shape = (1,) After (22.3.0+): unchanged.\nEnforce empty lines before classes/functions with sticky leading comments The old (“before”) behaviour here caused flake8 to raise E302.\nSource:\nsome_var = 1 # Leading sticky comment def some_func(): ... def get_search_results(self, request, queryset, search_term): \"\"\" Return a tuple containing a queryset to implement the search and a boolean indicating if the results may contain duplicates. \"\"\" # Apply keyword searches. def construct_search(field_name): ... ... Before: unchanged.\nAfter (22.12.0+):\nsome_var = 1 # Leading sticky comment def some_func(): ... def get_search_results(self, request, queryset, search_term): \"\"\" Return a tuple containing a queryset to implement the search and a boolean indicating if the results may contain duplicates. \"\"\" # Apply keyword searches. def construct_search(field_name): ... ... Empty and whitespace-only files are now normalized Currently under the stable style, empty and whitespace-only files are not modified. In some discussions (issues and pull requests), the consesus was to reformat whitespace-only files to empty or single-character files, preserving the original line endings (LR/CRLR) when possible.\nIn the end, we settled on these rules:\nEmpty files are left as is Whitespace-only files (no newline) reformat into empty files Whitespace-only files (1 or more newlines) reformat into a single newline character This was added to the preview style in 22.12.0.\nSpyder cell separator comments (#%%) are now normalized Black adds a space after the pound character in comments as per PEP 8. This caused trouble as many editors have special comments for various functionality (eg. denoting regions in the file) which could not contain any spaces.\nTo play with other tools, Black leaves Spyder’s special #%% comments (among other special comments) alone.\nSometime later, Spyder started to recognize # %% alongside #%%. So in Black 22.3.0, the preview style was changed to start adding spaces in #%% comments.\nWhat is not being promoted? Ideally I would’ve provided examples for these changes too, but I need to get this post out quickly and I’m getting tired. I’ve added links for further reading if you’re curious.\nExperimental string processing (aka ESP) is not being promoted to the 2023 stable preview. There’s a lot of reasons why, but Jelle summarized it well in this comment:\n[…] At this point there’s still half a dozen stability bugs with experimental string processing, so that alone is enough to block it from going into the 2023 stable style. However, I think we should consider dropping (most of) the feature entirely, instead of leaving it behind a flag forever, since there are so many stability bugs and often it arguably makes for worse output. That should be discussed in #2188, though.\nAnd these three depend on ESP being promoted:\nWrap implicitly concatenated strings inside a list, set, or tuple in parentheses (#3162) Wrap implicitly concatenated strings used as function args in parentheses (#3307) Fix a string merging/split issue caused by standalone comments (#3227) Additionally, two other changes are currently not slated for promotion and will remain in the preview style until 2024, mostly since they were landed too late in the year to allow for enough testing. These are:\nFor assignment statements, prefer splitting the right hand side if the left hand side fits on a single line (#3368) ~ available in 22.12.0+ Improve long values in dict literals (#3440) ~ available on main and in 23.1a1 only “I want a new change to the stable style” If you want a change that’s not covered by something in the preview style already (and can’t be achieved by simply tweaking a pre-existing style change), check the issue tracker for a issue that covers what you want. If you don’t find one, file an issue here or drop a comment here.\nAlthough, if you’re hoping to squeeze in a new major style change into the 2023 stable style, that probably won’t be possible being so late in the year. It can always be promoted to stable for 2024.\nThere’s some interesting history to why we added this flag, but I don’t have time to get into it right now. ↩︎\n","wordCount":"1848","inLanguage":"en-ca","datePublished":"2022-12-18T00:00:00-05:00","dateModified":"2023-01-03T22:30:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ichard26.github.io/blog/2022/12/black-23.1a1/"},"publisher":{"@type":"Person","name":"Richard Si","logo":{"@type":"ImageObject","url":"https://ichard26.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ichard26.github.io/ accesskey=h title="Richard Si (Alt + H)">Richard Si</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ichard26.github.io/about/ title=About><span>about</span></a></li><li><a href=https://ichard26.github.io/blog/ title=Writing><span>writing</span></a></li><li><a href=https://ichard26.github.io/privacy/ title="Privacy Statement"><span>privacy</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Black 23.1a1 - please help us test the 2023 stable style!</h1><div class=post-description>We just released Black 23.1a1 with the first draft of the 2023 stable style, please try it out and let us know your feedback and concerns.</div><div class=post-meta><span class=post-date title='Posted on 2022-12-18 00:00:00 -0500 EST'>December 18, 2022</span><span class=delimiter>&nbsp;·&nbsp;</span><span class=last-modified title='Updated on 2023-01-03 22:30:00 -0500 -0500'>Updated on January 3, 2023</span><span class=delimiter>&nbsp;·&nbsp;</span>9 minutes</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#promoted-changes aria-label="Promoted changes">Promoted changes</a><ul><li><a href=#bugfixes aria-label=Bugfixes>Bugfixes</a><ul><li><a href=#--skip-string-normalization-now-prevents-docstring-prefixes-from-being-normalized aria-label="--skip-string-normalization now prevents docstring prefixes from being normalized">--skip-string-normalization now prevents docstring prefixes from being normalized</a></li><li><a href=#--skip-magic-trailing-comma-now-removes-useless-trailing-commas-in-subscripts aria-label="--skip-magic-trailing-comma now removes useless trailing commas in subscripts">--skip-magic-trailing-comma now removes useless trailing commas in subscripts</a></li><li><a href=#correctly-handle-trailing-commas-that-are-inside-a-lines-leading-non-nested-parens aria-label="Correctly handle trailing commas that are inside a line&rsquo;s leading non-nested parens">Correctly handle trailing commas that are inside a line&rsquo;s leading non-nested parens</a></li></ul></li><li><a href=#end-quotes-that-violate-the-line-length-limit-in-multiline-docstrings-will-be-moved aria-label="End quotes that violate the line length limit in multiline docstrings will be moved">End quotes that violate the line length limit in multiline docstrings will be moved</a></li><li><a href=#better-management-of-parentheses aria-label="Better management of parentheses">Better management of parentheses</a><ul><li><a href=#return-type-annotations aria-label="Return type annotations">Return type annotations</a></li><li><a href=#remove-redundant-parentheses-around-awaited-objects aria-label="Remove redundant parentheses around awaited objects">Remove redundant parentheses around awaited objects</a></li><li><a href=#remove-redundant-parentheses-in-with-statements aria-label="Remove redundant parentheses in with statements">Remove redundant parentheses in with statements</a></li><li><a href=#remove-redundant-parentheses-from-except-clauses aria-label="Remove redundant parentheses from except clauses">Remove redundant parentheses from except clauses</a></li><li><a href=#remove-redundant-outermost-parentheses-in-for-statements aria-label="Remove redundant (outermost) parentheses in for statements">Remove redundant (outermost) parentheses in for statements</a></li></ul></li><li><a href=#remove-blank-lines-after-code-block-open aria-label="Remove blank lines after code block open">Remove blank lines after code block open</a></li><li><a href=#ignore-magic-trailing-comma-for-single-element-subscripts aria-label="Ignore magic trailing comma for single-element subscripts">Ignore magic trailing comma for single-element subscripts</a></li><li><a href=#enforce-empty-lines-before-classesfunctions-with-sticky-leading-comments aria-label="Enforce empty lines before classes/functions with sticky leading comments">Enforce empty lines before classes/functions with sticky leading comments</a></li><li><a href=#empty-and-whitespace-only-files-are-now-normalized aria-label="Empty and whitespace-only files are now normalized">Empty and whitespace-only files are now normalized</a></li><li><a href=#spyder-cell-separator-comments--are-now-normalized aria-label="Spyder cell separator comments (#%%) are now normalized">Spyder cell separator comments (#%%) are now normalized</a></li></ul></li><li><a href=#what-is-not-being-promoted aria-label="What is not being promoted?">What is not being promoted?</a></li><li><a href=#i-want-a-new-change-to-the-stable-style aria-label="&ldquo;I want a new change to the stable style&rdquo;">&ldquo;I want a new change to the stable style&rdquo;</a></li></ul></div></details></div><div class=post-content><p>As the post summary says, earlier today <a href=https://github.com/psf/black/releases/tag/23.1a1 target=_blank>we released Black 23.1a1</a>. You might
be wondering why we released an alpha&mldr; it&rsquo;s because the upcoming Black 23.1.0 release
will see many <strong>preview</strong> code style changes promoted to the <strong>stable</strong> style.</p><p>In other words, <strong>Black 23.1.0 will format your code differently out of the box</strong>.</p><blockquote><p>If you&rsquo;re surprised we&rsquo;re doing this, our <a href=https://black.readthedocs.io/en/stable/the_black_code_style/index.html#stability-policy target=_blank>stability policy</a> allows us
to update the stable style in the new year. This minimises disruption while keeping the
door for improvements open.</p></blockquote><p>23.1a1 contains a draft of the 2023 stable style that we, the maintainers, initially
decided on.</p><p>However, <strong>we need your help in finalizing what goes into the 2023 stable style</strong>. If you
can, please try 23.1a1 out on your codebase(s). You can install it by running this
command:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python -m pip install black<span style=color:#f92672>==</span>23.1a1
</span></span></code></pre></div><p><strong>If you have any feedback, concerns, or run into any issues, please drop us a comment
<a href=https://github.com/psf/black/issues/3407 target=_blank>in this issue</a></strong> (<a href=https://github.com/psf/black/issues/3407 target=_blank>https://github.com/psf/black/issues/3407</a>).</p><blockquote><p><strong>Note</strong>: Please read the start of the issue description before commenting. It will make
the lives of everyone easier.</p></blockquote><p>What follows is brief rundown of all of the changes in the preview style that were
promoted to stable in 23.1a1.</p><h2 id=promoted-changes>Promoted changes<a hidden class=anchor aria-hidden=true href=#promoted-changes>#</a></h2><h3 id=bugfixes>Bugfixes<a hidden class=anchor aria-hidden=true href=#bugfixes>#</a></h3><h4 id=--skip-string-normalization-now-prevents-docstring-prefixes-from-being-normalized><code>--skip-string-normalization</code> now prevents docstring prefixes from being normalized<a hidden class=anchor aria-hidden=true href=#--skip-string-normalization-now-prevents-docstring-prefixes-from-being-normalized>#</a></h4><p><code>-S</code> / <code>--skip-string-normalization</code> stops Black from normalizing string prefixes and
quotes, except when it doesn&rsquo;t&mldr;</p><p>Sometime ago I accidentally added a bug where Black would normalize docstring prefixes
even if you told it not to, leading to this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span> def add(a, b):
</span></span><span style=display:flex><span><span style=color:#f92672>-    F&#34;&#34;&#34;Add two numbers and return the result.&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+    f&#34;&#34;&#34;Add two numbers and return the result.&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>     return a + b
</span></span></code></pre></div><p><a href=https://github.com/psf/black/pull/3168 target=_blank>This has been fixed in the preview style since 22.8.0</a> (leaving this example
unchanged).</p><h4 id=--skip-magic-trailing-comma-now-removes-useless-trailing-commas-in-subscripts><code>--skip-magic-trailing-comma</code> now removes useless trailing commas in subscripts<a hidden class=anchor aria-hidden=true href=#--skip-magic-trailing-comma-now-removes-useless-trailing-commas-in-subscripts>#</a></h4><p>Black has the concept of &ldquo;magic trailing commas.&rdquo;
<a href=https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html#the-magic-trailing-comma target=_blank>You can read about it here</a>, but in essence, Black treats trailing
commas as a sign that collections, calls, or function signatures should always be
exploded.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#75715e># The trailing comma will stop Black from collapsing this collection into one line.</span>
</span></span><span style=display:flex><span>TRANSLATIONS <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;en_us&#34;</span>: <span style=color:#e6db74>&#34;English (US)&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;pl_pl&#34;</span>: <span style=color:#e6db74>&#34;polski&#34;</span>,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This can be disabled passing the <code>-C</code> / <code>--skip-magic-trailing-comma</code> flag.<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><p>However, Black didn&rsquo;t remove unnecessary trailing commas in all situations. In the
following example, the trailing comma in the function signature was removed as expected,
but not the subscript.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span> Point = Tuple[int, int,]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>-def f(a: Point, b: Point,): ...
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+def f(a: Point, b: Point): ...
</span></span></span></code></pre></div><p><a href=https://github.com/psf/black/pull/3209 target=_blank>This was fixed in the preview style since 22.8.0</a>, which removes both commas as
expected.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span><span style=color:#f92672>-Point = Tuple[int, int,]
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+Point = Tuple[int, int]
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>
</span></span><span style=display:flex><span><span style=color:#f92672>-def f(a: Point, b: Point,): ...
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+def f(a: Point, b: Point): ...
</span></span></span></code></pre></div><h4 id=correctly-handle-trailing-commas-that-are-inside-a-lines-leading-non-nested-parens>Correctly handle trailing commas that are inside a line&rsquo;s leading non-nested parens<a hidden class=anchor aria-hidden=true href=#correctly-handle-trailing-commas-that-are-inside-a-lines-leading-non-nested-parens>#</a></h4><p>There are actually two problems in the &ldquo;before&rdquo; output:</p><ul><li>The <code>zero(one,).two(three,).four(five,)</code> chain should be fully exploded</li><li>The magic trailing comma in the dictionary in <code>refresh_token()</code> is being ignored</li></ul><p><strong>Source:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span>zero(one,)<span style=color:#f92672>.</span>two(three,)<span style=color:#f92672>.</span>four(five,)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>refresh_token</span>(self, device_family, refresh_token, api_key):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>get(
</span></span><span style=display:flex><span>        data<span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;refreshToken&#34;</span>: refresh_token,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        api_key<span style=color:#f92672>=</span>api_key,
</span></span><span style=display:flex><span>    )[<span style=color:#e6db74>&#34;sdk&#34;</span>][<span style=color:#e6db74>&#34;token&#34;</span>]
</span></span></code></pre></div><p><strong>Before:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span>zero(one,)<span style=color:#f92672>.</span>two(three,)<span style=color:#f92672>.</span>four(
</span></span><span style=display:flex><span>    five,
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>refresh_token</span>(self, device_family, refresh_token, api_key):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>get(data<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;refreshToken&#34;</span>: refresh_token,}, api_key<span style=color:#f92672>=</span>api_key,)[
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;sdk&#34;</span>
</span></span><span style=display:flex><span>    ][<span style=color:#e6db74>&#34;token&#34;</span>]
</span></span></code></pre></div><p><strong>After</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span>zero(
</span></span><span style=display:flex><span>    one,
</span></span><span style=display:flex><span>)<span style=color:#f92672>.</span>two(
</span></span><span style=display:flex><span>    three,
</span></span><span style=display:flex><span>)<span style=color:#f92672>.</span>four(
</span></span><span style=display:flex><span>    five,
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>refresh_token</span>(self, device_family, refresh_token, api_key):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>get(
</span></span><span style=display:flex><span>        data<span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;refreshToken&#34;</span>: refresh_token,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        api_key<span style=color:#f92672>=</span>api_key,
</span></span><span style=display:flex><span>    )[
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;sdk&#34;</span>
</span></span><span style=display:flex><span>    ][<span style=color:#e6db74>&#34;token&#34;</span>]
</span></span></code></pre></div><p><a href=https://github.com/psf/black/pull/3370 target=_blank>Both these issues have been fixed in the preview style since 22.12.0</a>.</p><h3 id=end-quotes-that-violate-the-line-length-limit-in-multiline-docstrings-will-be-moved>End quotes that violate the line length limit in multiline docstrings will be moved<a hidden class=anchor aria-hidden=true href=#end-quotes-that-violate-the-line-length-limit-in-multiline-docstrings-will-be-moved>#</a></h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style=background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>process_and_count</span>(text):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#e6db74>    Remove punctuation and return cleaned string, in addition to its length in tokens.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>example_2</span>(text):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Remove punctuation and return cleaned string in addition to its length in tokens.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span></code></pre></td></tr></table></div></div><p>Here, the third line violates the line length limit (90 > 88) because of the end quotes.
Earlier versions of Black would leave this be which wasn&rsquo;t ideal, so now they are moved
onto their own line.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span> def process_and_count(text):
</span></span><span style=display:flex><span>     &#34;&#34;&#34;
</span></span><span style=display:flex><span><span style=color:#f92672>-    Remove punctuation and return cleaned string, in addition to its length in tokens.&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+    Remove punctuation and return cleaned string, in addition to its length in tokens.
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+    &#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>     pass
</span></span></code></pre></div><p>However, Black won&rsquo;t move quotes of single line docstrings (such as with <code>example_2()</code>)
since that would look ugly.</p><p>This was <a href=https://github.com/psf/black/pull/3044 target=_blank>added to the preview style in 22.8.0</a> and
<a href=https://github.com/psf/black/pull/3430 target=_blank>then tweaked in 23.1a1</a>.</p><h3 id=better-management-of-parentheses>Better management of parentheses<a hidden class=anchor aria-hidden=true href=#better-management-of-parentheses>#</a></h3><p>Here&rsquo;s a set of changes that together improve Black&rsquo;s handling of parentheses in various
situations.</p><p>Out of these five,
<a href=#remove-redundant-outermost-parentheses-in-for-statements>&ldquo;Remove redundant (outermost) parentheses in for statements&rdquo;</a>
will probably be the most impactful.</p><h4 id=return-type-annotations>Return type annotations<a hidden class=anchor aria-hidden=true href=#return-type-annotations>#</a></h4><p><strong>Source:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>() <span style=color:#f92672>-&gt;</span> (int):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>() <span style=color:#f92672>-&gt;</span> intsdfsafafafdfdsasdfsfsdfasdfafdsafdfdsfasdskdsdsfdsafdsafsdfdasfffsfdsfdsafafhdskfhdsfjdslkfdlfsdkjhsdfjkdshfkljds:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>frobnicate</span>() <span style=color:#f92672>-&gt;</span> ThisIsTrulyUnreasonablyExtremelyLongClassName <span style=color:#f92672>|</span> list[ThisIsTrulyUnreasonablyExtremelyLongClassName]:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span></code></pre></div><p><strong>Before:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>() <span style=color:#f92672>-&gt;</span> (int):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>() <span style=color:#f92672>-&gt;</span> intsdfsafafafdfdsasdfsfsdfasdfafdsafdfdsfasdskdsdsfdsafdsafsdfdasfffsfdsfdsafafhdskfhdsfjdslkfdlfsdkjhsdfjkdshfkljds:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>frobnicate</span>() <span style=color:#f92672>-&gt;</span> ThisIsTrulyUnreasonablyExtremelyLongClassName <span style=color:#f92672>|</span> list[
</span></span><span style=display:flex><span>    ThisIsTrulyUnreasonablyExtremelyLongClassName
</span></span><span style=display:flex><span>]:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span></code></pre></div><p><strong>After</strong> (<a href=https://github.com/psf/black/pull/2990 target=_blank>22.6.0+</a>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>() <span style=color:#f92672>-&gt;</span> int:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>() <span style=color:#f92672>-&gt;</span> (
</span></span><span style=display:flex><span>    intsdfsafafafdfdsasdfsfsdfasdfafdsafdfdsfasdskdsdsfdsafdsafsdfdasfffsfdsfdsafafhdskfhdsfjdslkfdlfsdkjhsdfjkdshfkljds
</span></span><span style=display:flex><span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>frobnicate</span>() <span style=color:#f92672>-&gt;</span> (
</span></span><span style=display:flex><span>    ThisIsTrulyUnreasonablyExtremelyLongClassName
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> list[ThisIsTrulyUnreasonablyExtremelyLongClassName]
</span></span><span style=display:flex><span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span></code></pre></div><h4 id=remove-redundant-parentheses-around-awaited-objects>Remove redundant parentheses around awaited objects<a hidden class=anchor aria-hidden=true href=#remove-redundant-parentheses-around-awaited-objects>#</a></h4><p><strong>Source:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> (asyncio<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> (set_of_tasks <span style=color:#f92672>|</span> other_set)
</span></span></code></pre></div><p><strong>Before:</strong> unchanged.</p><p><strong>After</strong> (<a href=https://github.com/psf/black/pull/2991 target=_blank>22.6.0+</a>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> asyncio<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> (set_of_tasks <span style=color:#f92672>|</span> other_set)
</span></span></code></pre></div><h4 id=remove-redundant-parentheses-in-with-statements>Remove redundant parentheses in with statements<a hidden class=anchor aria-hidden=true href=#remove-redundant-parentheses-in-with-statements>#</a></h4><p><strong>Source:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#66d9ef>with</span> (open(<span style=color:#e6db74>&#34;bla.txt&#34;</span>)):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> (open(<span style=color:#e6db74>&#34;bla.txt&#34;</span>)), (open(<span style=color:#e6db74>&#34;bla.txt&#34;</span>)):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> (open(<span style=color:#e6db74>&#34;bla.txt&#34;</span>) <span style=color:#66d9ef>as</span> f):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> (open(<span style=color:#e6db74>&#34;bla.txt&#34;</span>)) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span></code></pre></div><p><strong>Before:</strong> unchanged.</p><p><strong>After</strong> (<a href=https://github.com/psf/black/pull/2926 target=_blank>22.6.0+</a>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#34;bla.txt&#34;</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#34;bla.txt&#34;</span>), open(<span style=color:#e6db74>&#34;bla.txt&#34;</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#34;bla.txt&#34;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#34;bla.txt&#34;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span></code></pre></div><h4 id=remove-redundant-parentheses-from-except-clauses>Remove redundant parentheses from except clauses<a hidden class=anchor aria-hidden=true href=#remove-redundant-parentheses-from-except-clauses>#</a></h4><p><strong>Source:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>    a<span style=color:#f92672>.</span>something
</span></span><span style=display:flex><span><span style=color:#66d9ef>except</span> (<span style=color:#a6e22e>AttributeError</span>) <span style=color:#66d9ef>as</span> err:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>raise</span> err
</span></span></code></pre></div><p><strong>Before:</strong> unchanged.</p><p><strong>After</strong> (<a href=https://github.com/psf/black/pull/2939 target=_blank>22.3.0+</a>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>    a<span style=color:#f92672>.</span>something
</span></span><span style=display:flex><span><span style=color:#66d9ef>except</span> <span style=color:#a6e22e>AttributeError</span> <span style=color:#66d9ef>as</span> err:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>raise</span> err
</span></span></code></pre></div><h4 id=remove-redundant-outermost-parentheses-in-for-statements>Remove redundant (outermost) parentheses in for statements<a hidden class=anchor aria-hidden=true href=#remove-redundant-outermost-parentheses-in-for-statements>#</a></h4><p><strong>Source:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#66d9ef>for</span> (k, v) <span style=color:#f92672>in</span> d<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>    print(k, v)
</span></span></code></pre></div><p><strong>Before:</strong> unchanged.</p><p><strong>After</strong> (<a href=https://github.com/psf/black/pull/2945 target=_blank>22.3.0+</a>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#66d9ef>for</span> k, v <span style=color:#f92672>in</span> d<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>    print(k, v)
</span></span></code></pre></div><p>Unfortunately, nested parentheses are still left untouched.
<a href=https://github.com/psf/black/pull/3243 target=_blank>I have an open PR to fix that</a>, but it isn&rsquo;t ready yet.</p><h3 id=remove-blank-lines-after-code-block-open>Remove blank lines after code block open<a hidden class=anchor aria-hidden=true href=#remove-blank-lines-after-code-block-open>#</a></h3><p>Here&rsquo;s another change that is likely to impact your codebase.</p><p><strong>Note</strong>: This new feature will be applied to <strong>all code blocks</strong>: <code>def</code>, <code>class</code>, <code>if</code>,
<code>for</code> , <code>while</code>, <code>with</code>, <code>case</code> and <code>match</code>.</p><p><strong>Source:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>():
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;All the newlines above me should be deleted!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> condition:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;No newline above me!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;There is a newline above me, and that&#39;s OK!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Point</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    x: int
</span></span><span style=display:flex><span>    y: int
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>as_tuple</span>(self) <span style=color:#f92672>-&gt;</span> tuple[int, int]:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (self<span style=color:#f92672>.</span>x, self<span style=color:#f92672>.</span>y)
</span></span></code></pre></div><p><strong>Before:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>():
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;All the newlines above me should be deleted!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> condition:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;No newline above me!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;There is a newline above me, and that&#39;s OK!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Point</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    x: int
</span></span><span style=display:flex><span>    y: int
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>as_tuple</span>(self) <span style=color:#f92672>-&gt;</span> tuple[int, int]:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (self<span style=color:#f92672>.</span>x, self<span style=color:#f92672>.</span>y)
</span></span></code></pre></div><p><strong>After</strong> (<a href=https://github.com/psf/black/pull/3035 target=_blank>22.6.0+</a>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>():
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;All the newlines above me should be deleted!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> condition:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;No newline above me!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;There is a newline above me, and that&#39;s OK!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Point</span>:
</span></span><span style=display:flex><span>    x: int
</span></span><span style=display:flex><span>    y: int
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>as_tuple</span>(self) <span style=color:#f92672>-&gt;</span> tuple[int, int]:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (self<span style=color:#f92672>.</span>x, self<span style=color:#f92672>.</span>y)
</span></span></code></pre></div><h3 id=ignore-magic-trailing-comma-for-single-element-subscripts>Ignore magic trailing comma for single-element subscripts<a hidden class=anchor aria-hidden=true href=#ignore-magic-trailing-comma-for-single-element-subscripts>#</a></h3><p>Black exempts single-element tuple literals from the usual handling of magic trailing
commas: <code>(1,)</code> will not have a newline added (as would happen for lists, sets, etc.).</p><p>However, if you wrote <code>tuple[int,]</code> (to make it more visually distinctive to <code>list[int]</code>),
Black would explode it, which doesn&rsquo;t look great.</p><p><strong>Source:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span>shape: tuple[int,]
</span></span><span style=display:flex><span>shape <span style=color:#f92672>=</span> (<span style=color:#ae81ff>1</span>,)
</span></span></code></pre></div><p><strong>Before:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span>shape: tuple[
</span></span><span style=display:flex><span>    int,
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>shape <span style=color:#f92672>=</span> (<span style=color:#ae81ff>1</span>,)
</span></span></code></pre></div><p><strong>After</strong> (<a href=https://github.com/psf/black/pull/2942 target=_blank>22.3.0+</a>): unchanged.</p><h3 id=enforce-empty-lines-before-classesfunctions-with-sticky-leading-comments>Enforce empty lines before classes/functions with sticky leading comments<a hidden class=anchor aria-hidden=true href=#enforce-empty-lines-before-classesfunctions-with-sticky-leading-comments>#</a></h3><p>The old (&ldquo;before&rdquo;) behaviour here caused flake8 to raise <code>E302</code>.</p><p><strong>Source:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span>some_var <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Leading sticky comment</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>some_func</span>():
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_search_results</span>(self, request, queryset, search_term):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Return a tuple containing a queryset to implement the search
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    and a boolean indicating if the results may contain duplicates.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Apply keyword searches.</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>construct_search</span>(field_name):
</span></span><span style=display:flex><span>        <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span></code></pre></div><p><strong>Before:</strong> unchanged.</p><p><strong>After</strong> (<a href=https://github.com/psf/black/pull/3302 target=_blank>22.12.0+</a>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span>some_var <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Leading sticky comment</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>some_func</span>():
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_search_results</span>(self, request, queryset, search_term):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Return a tuple containing a queryset to implement the search
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    and a boolean indicating if the results may contain duplicates.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Apply keyword searches.</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>construct_search</span>(field_name):
</span></span><span style=display:flex><span>        <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span></code></pre></div><h3 id=empty-and-whitespace-only-files-are-now-normalized>Empty and whitespace-only files are now normalized<a hidden class=anchor aria-hidden=true href=#empty-and-whitespace-only-files-are-now-normalized>#</a></h3><p>Currently under the stable style, empty and whitespace-only files are not modified. In
some discussions (<a href=https://github.com/psf/black/issues/2382 target=_blank>issues</a> and <a href=https://github.com/psf/black/pull/2484 target=_blank>pull requests</a>), the consesus was to
reformat whitespace-only files to empty or single-character files, preserving the original
line endings (LR/CRLR) when possible.</p><p>In the end, we settled on these rules:</p><ul><li>Empty files are left as is</li><li>Whitespace-only files (no newline) reformat into empty files</li><li>Whitespace-only files (1 or more newlines) reformat into a single newline character</li></ul><p><a href=https://github.com/psf/black/pull/3348 target=_blank>This was added to the preview style in 22.12.0</a>.</p><h3 id=spyder-cell-separator-comments--are-now-normalized>Spyder cell separator comments (<code>#%%</code>) are now normalized<a hidden class=anchor aria-hidden=true href=#spyder-cell-separator-comments--are-now-normalized>#</a></h3><p>Black adds a space after the pound character in comments as per PEP 8. This caused trouble
as many editors have special comments for various functionality (eg. denoting regions in
the file) which could not contain any spaces.</p><p>To play with other tools, Black leaves Spyder&rsquo;s special <code>#%%</code> comments (among other
special comments) alone.</p><p>Sometime later, Spyder started to recognize <code># %%</code> alongside <code>#%%</code>. So
<a href=https://github.com/psf/black/pull/2919 target=_blank>in Black 22.3.0, the preview style was changed</a> to start adding spaces in <code>#%%</code>
comments.</p><h2 id=what-is-not-being-promoted>What is not being promoted?<a hidden class=anchor aria-hidden=true href=#what-is-not-being-promoted>#</a></h2><p><em>Ideally I would&rsquo;ve provided examples for these changes too, but I need to get this post
out quickly and I&rsquo;m getting tired. I&rsquo;ve added links for further reading if you&rsquo;re
curious.</em></p><p><a href=https://github.com/psf/black/pull/1132 target=_blank><strong>Experimental string processing</strong></a> (aka ESP) is not being promoted to the 2023
stable preview. There&rsquo;s a lot of reasons why, but
<a href=https://github.com/psf/black/issues/3407#issuecomment-1345416311 target=_blank>Jelle summarized it well in this comment</a>:</p><blockquote><p>[&mldr;] At this point there&rsquo;s still half a dozen stability bugs with experimental string
processing, so that alone is enough to block it from going into the 2023 stable style.
However, I think we should consider dropping (most of) the feature entirely, instead of
leaving it behind a flag forever, since there are so many stability bugs and often it
arguably makes for worse output. That should be discussed in <a href=https://github.com/psf/black/issues/2188 target=_blank>#2188</a>, though.</p></blockquote><p>And these three depend on ESP being promoted:</p><ul><li><a href=https://github.com/psf/black/pull/3162 target=_blank>Wrap implicitly concatenated strings inside a list, set, or tuple in parentheses (#3162)</a></li><li><a href=https://github.com/psf/black/pull/3307 target=_blank>Wrap implicitly concatenated strings used as function args in parentheses (#3307)</a></li><li><a href=https://github.com/psf/black/pull/3227 target=_blank>Fix a string merging/split issue caused by standalone comments (#3227)</a></li></ul><p>Additionally, two other changes are currently not slated for promotion and will remain in
the preview style until 2024, mostly since they were landed too late in the year to allow
for enough testing. These are:</p><ul><li><a href=https://github.com/psf/black/pull/3368 target=_blank>For assignment statements, prefer splitting the right hand side if the left hand side fits on a single line (#3368)</a>
~ <em>available in 22.12.0+</em></li><li><a href=https://github.com/psf/black/pull/3440 target=_blank>Improve long values in dict literals (#3440)</a> ~ <em>available on main and in 23.1a1
only</em></li></ul><h2 id=i-want-a-new-change-to-the-stable-style>&ldquo;I want a <em>new</em> change to the stable style&rdquo;<a hidden class=anchor aria-hidden=true href=#i-want-a-new-change-to-the-stable-style>#</a></h2><p>If you want a change that&rsquo;s not covered by something in the preview style already (and
can&rsquo;t be achieved by simply tweaking a pre-existing style change), check the issue tracker
for a issue that covers what you want. If you don&rsquo;t find one,
<a href="https://github.com/psf/black/issues/new?assignees=&amp;labels=T%3A+design&amp;template=style_issue.md&amp;title=" target=_blank>file an issue here</a> or <a href=https://github.com/psf/black/issues/3407 target=_blank>drop a comment here</a>.</p><p>Although, if you&rsquo;re hoping to squeeze in a new major style change into the 2023 <strong>stable</strong>
style, that probably won&rsquo;t be possible being so late in the year. It can always be
promoted to stable for 2024.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>There&rsquo;s some interesting history to why we added this flag, but I don&rsquo;t have time to
get into it right now.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://ichard26.github.io/tags/black/>black</a></li><li><a href=https://ichard26.github.io/tags/release/>release</a></li></ul><nav class=paginav><a class=prev href=https://ichard26.github.io/blog/2023/01/black-23.1.0/><span class=title>« Newer</span><br><span>What's new in Black 23.1.0</span></a>
<a class=next href=https://ichard26.github.io/blog/2022/10/black-22.10.0/><span class=title>Older »</span><br><span>What's new in Black 22.10.0</span></a></nav></footer></article></main><footer class=footer><span>© 2022-present, Richard Si</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>