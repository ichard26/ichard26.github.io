<!doctype html><html lang=en-ca dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>What's new in pip 24.2 ‚Äî or why legacy editable installs are deprecated | Richard Si</title><meta name=keywords content="pip,release,deprecation"><meta name=description content="In version 24.2, pip learns to use system certificates by default, receives a handful of optimizations, and deprecates legacy (setup.py develop) editable installations."><meta name=author content><link rel=canonical href=https://ichard26.github.io/blog/2024/08/whats-new-in-pip-24.2/><link crossorigin=anonymous href=/assets/css/stylesheet.511e79342de7efc9751cf035c8c3f91cd02f8d2b2acc4eebd5e1d91cac0ef23b.css integrity="sha256-UR55NC3n78l1HPA1yMP5HNAvjSsqzE7r1eHZHKwO8js=" rel="preload stylesheet" as=style><link rel=icon href=https://ichard26.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ichard26.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ichard26.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ichard26.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ichard26.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script defer data-domain=ichard26.github.io src=https://webstats.internal.floralily.dev/js/script.outbound-links.js></script><meta name=google-site-verification content="4PNzC3Db8jI_wn9D8lPdAh4B0skrLZHNbQBgVF1XtAo"><meta property="og:title" content="What's new in pip 24.2 ‚Äî or why legacy editable installs are deprecated"><meta property="og:description" content="In version 24.2, pip learns to use system certificates by default, receives a handful of optimizations, and deprecates legacy (setup.py develop) editable installations."><meta property="og:type" content="article"><meta property="og:url" content="https://ichard26.github.io/blog/2024/08/whats-new-in-pip-24.2/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-08-26T00:00:00-04:00"><meta property="article:modified_time" content="2024-08-29T00:00:00-04:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="What's new in pip 24.2 ‚Äî or why legacy editable installs are deprecated"><meta name=twitter:description content="In version 24.2, pip learns to use system certificates by default, receives a handful of optimizations, and deprecates legacy (setup.py develop) editable installations."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://ichard26.github.io/blog/"},{"@type":"ListItem","position":2,"name":"What's new in pip 24.2 ‚Äî or why legacy editable installs are deprecated","item":"https://ichard26.github.io/blog/2024/08/whats-new-in-pip-24.2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"What's new in pip 24.2 ‚Äî or why legacy editable installs are deprecated","name":"What\u0027s new in pip 24.2 ‚Äî or why legacy editable installs are deprecated","description":"In version 24.2, pip learns to use system certificates by default, receives a handful of optimizations, and deprecates legacy (setup.py develop) editable installations.","keywords":["pip","release","deprecation"],"articleBody":"On July 28, 2024, the pip team released pip 24.2. As a recent addition to the pip core team, I‚Äôll walk you through the noteworthy or interesting changes from pip 24.2. Let‚Äôs go!\nPSA, PSA, PSA üì£ If you‚Äôre using setuptools, do not have a pyproject.toml, and use pip‚Äôs -e flag, you may be impacted by the deprecation of legacy editable installs.\nIf you‚Äôre an user of setuptools and came to this post after seeing the legacy editable install deprecation warning, you should first read the deprecation issue for solutions, not here.\nYou can come back and read this after for more historical context on the deprecation, however! It‚Äôs a good read, I promise.\nHere‚Äôs a link to the 24.2 changelog if you‚Äôd like the full list of changes.\nLegacy editable installs are deprecated TL;DR, don‚Äôt panic. The -e option is not deprecated, but the way it works under the hood will change, potentially necessitating changes to how your project is packaged.\nOver the last decade, there has been a major transition towards standardized mechanisms for packaging Python projects:\nPEP 517: introduced an interface where frontends (e.g. the pip installer) can interact with a build backend (e.g. Poetry1), including asking it to build a wheel for later installation PEP 518: introduced pyproject.toml and defined a standard format for declaring build-time dependencies using this file PEP 621: defined a standard format for declaring project metadata in pyproject.toml PEP 660: augmented the PEP 517 interface to define a way to ask a build backend to prepare an editable install These PEPs are what enable the use of alternative backends like Poetry, Hatch, and scikit-build-core without needing to add specific support for each backend in every frontend (e.g. pip, tox, uv). Instead of running setup.py bdist_wheel to ask setuptools to build a wheel for installation, pip can simply call the build_wheel hook2 from PEP 517 which all backends are guaranteed to have.\nAs each standard matured, pip has progressively deprecated and removed support for legacy (and often setuptools-specific) mechanisms to reduce technical debt and ensure that pip can continue to evolve.\nEditable installs‚Äîthe thing you get from pip install -e ‚Äîused to be a setuptools only feature, requiring pip to call the project‚Äôs setup.py with the develop sub-command. However, this stopped being the case under PEP 660. As long as your project‚Äôs backend supports PEP 660, pip install -e will continue to work. No setuptools required. (Although modern setuptools works fine as well.)\nOK, so what now? This release, pip has deprecated support for the setup.py develop fallback which is used when a project lacks support for modern editable installs. It will be removed in pip 25.0 (Q1 2025) after which projects MUST support PEP 660 to perform an editable install. Affected projects will see this deprecation warning:\npip install -e temp/pip-test-package Obtaining file:///home/ichard26/dev/oss/pip/temp/pip-test-package Preparing metadata (setup.py) ... done Installing collected packages: version_pkg DEPRECATION: Legacy editable install of version_pkg==0.1 from file:///home/ichard26/dev/oss/pip/temp/pip-test-package (setup.py develop) is deprecated. pip 25.0 will enforce this behaviour change. A possible replacement is to add a pyproject.toml or enable --use-pep517, and use setuptools \u003e= 64. If the resulting installation is not behaving as expected, try using --config-settings editable_mode=compat. Please consult the setuptools documentation for more information. Discussion can be found at https://github.com/pypa/pip/issues/11457 Running setup.py develop for version_pkg Successfully installed version_pkg-0.1 In practice, this usually means one of two things:\nThe pyproject.toml file doesn‚Äôt exist at all, thus pip will opt-out of the PEP 517 interface, running setup.py as required The declared setuptools version (in the [build-system].requires field) is too old and doesn‚Äôt support PEP 660, i.e. anything older than setuptools 64.0.0 For affected projects, the best solution is likely to use a modern version of setuptools and declare this via pyproject.toml. You can place your project metadata in this file as well, but it‚Äôs not required to stop the legacy editable deprecation warnings.\n# pyproject.toml [build-system] requires = [\"setuptools \u003e= 64\"] build-backend = \"setuptools.build_meta\" Tip: if you have other dependencies needed to run setup.py or otherwise build your package, you should add them to the [\"setuptools \u003e= 64\"] list. This field is equivalent to setuptools‚Äô setup_requires parameter.\nAlternatively, projects can pass the --enable-pep517 flag to force pip to use the PEP 517 interface, including the editable install extensions from PEP 660. If no backend is declared, pip will assume that the project uses setuptools and ensure it‚Äôs available in the isolated build environment.3 As long as setuptools 64+ still supports your Python version, a modern editable install will be performed. Once the legacy mechanism is removed, --use-pep517 will have no effect and will essentially be enabled by default.\nFinally, if you don‚Äôt like either of those solutions, you can always throw away setuptools and switch to a different backend entirely. I‚Äôve mentioned a few earlier, but there are even more options to choose from if you‚Äôre willing to do some research and play around. I‚Äôd start with with the Python Packaging User Guide‚Äôs list of the commonly used backends if you want to replace setuptools.\nIf you stick with setuptools, one potential snag is that setuptools has introduced a new kind of editable installs while rolling out PEP 660 by default:\nIf a package uses the ‚Äúsrc‚Äù layout or otherwise places the source code in a separate top-level directory, setuptools will create a static .pth file to extend the Python import path with that directory If a package uses the ‚Äúflat‚Äù layout, setuptools will install a custom import hook which intercepts imports and ‚Äúredirects‚Äù them to the original modules (so auxiliary top-level files like noxfile.py or setup.py or a tests package aren‚Äôt importable) If the legacy behaviour is desired, one must pass --config-settings editable_mode=compat. There is also one more method: strict editable installs. They behave closer to a normal installation, but are implemented in an entirely different way from setup.py or the default method described above.4\n(Update: a setuptools maintainer reached out to strict editable installs are not enabled by default. It turns out that the situation behind potential breakage is a bit more nuanced. Sorry!)\nWarning: Static analysis tools including mypy, pyright, and pylint may not function properly when setuptools uses an import hook to implement an editable install. This is a known issue. The recommended workaround is to pass --config-settings editable_mode=compat.\nFor more details using setuptools with pyproject.toml, you should read their documentation:\n‚≠ê User guide to using pyproject.toml ‚≠ê ‚≠ê setuptools‚Äô editable install docs ‚≠ê setuptools‚Äô build system docs If you‚Äôd like to learn more, especially about the history of why and how these standards came to exist, I strongly recommend reading Paul Ganssle‚Äôs excellent ‚ÄúWhy you shouldn‚Äôt invoke setup.py directly‚Äù article. It‚Äôs long, but packs way more information than I could ever hope to cover.\nSystem HTTPS certificates by default(*) If you‚Äôve ever used pip in a corporate environment, there is a good chance that you‚Äôve encountered a network or SSL verification error because the remote index server (PyPI or a private index) returned a HTTPS certificate that couldn‚Äôt be verified.\npip install toto Looking in indexes: https://repos.company/api/pypi/python_pypi/simple WARNING: Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(SSLError(0, 'unknown error (_ssl.c:3630)'),)': /api/pypi/python_pypi/simple/toto/ WARNING: Retrying (Retry(total=3, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(SSLError(0, 'unknown error (_ssl.c:3630)'),)': /api/pypi/python_pypi/simple/toto/ WARNING: Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(SSLError(0, 'unknown error (_ssl.c:3630)'),)': /api/pypi/python_pypi/simple/toto/ WARNING: Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(SSLError(0, 'unknown error (_ssl.c:3630)'),)': /api/pypi/python_pypi/simple/toto/ WARNING: Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(SSLError(0, 'unknown error (_ssl.c:3630)'),)': /api/pypi/python_pypi/simple/toto/ Could not fetch URL https://repos.company/api/pypi/python_pypi/simple/toto/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host= 'repos.company', port=443): Max retries exceeded with url: /api/pypi/python_pypi/simple/toto/ (Caused by SSLError(SSLError(0, 'unknown error (_ssl.c:3630)'),)) - skipping ERROR: Could not find a version that satisfies the requirement toto (from versions: none) ERROR: No matching distribution found for toto The problem is that while your system may be configured with the required certificate authorities, pip had no ability to use those system CAs. This resulted in a confusing user experience, because while your browser was likely able to access the index server, pip blew up with a non-obvious error.\nTo be able to verify HTTPS certificates, since the early days, pip has shipped with the certifi CA bundle, which is simply a Python repackaging of the Mozilla CA bundle. To get pip to verify HTTPS certificates not trusted by certifi, you had to pass your own bundle via the --cert option which is clunky.\nIn pip 22.2, pip gained the ability to use truststore for HTTPS certificate validation, enabling pip to use the system certificate store instead of solely relying on certifi. The integration was experimental; users had to have truststore already installed and opt-in via --use-feature=truststore, but it was a step forward.5 The plan was to enable truststore by default once the feature matured.\nTwo years later, in this pip release, truststore is now enabled by default.6 Thus, assuming your system is configured properly with the required CAs, pip should simply ‚Äújust work‚Äù even in many corporate environments. üéâ\nThere is one major problem though‚Äîyou saw that asterisk, right? Truststore only works on Python 3.10 or higher. pip will continue to exclusively use its certifi bundle on Python 3.9 or 3.8. Additionally, any Python implementation that does not implement the ssl module APIs needed by truststore will not be able to use the system trust store either. In these situations, you will need to continue using --cert.\nMajor thanks goes to @sethmlarson for co-authoring truststore and writing patches improving and fixing pip‚Äôs truststore integration!\nPerformance optimizations, duh! In this release, several optimizations of the environment inspection, file download, dependency resolution, and installation logic landed. While individually they are minor optimizations, together they provide a noticeable performance uplift in a variety of workloads!\nFaster discovery of installed packages First of all, on Python 3.11 or higher, pip is significantly faster to discover installed packages (especially if there are a lot of ‚Äôem). This not only makes pip list faster, but also makes pip generally faster as it has to figure out what packages are already installed quite frequently throughout its operation.\nThese are the before and after runtimes of pip list in my pip development environment which has 75 packages installed:\n# before: pip list (24.1) real\t0m0.227s user\t0m0.192s sys 0m0.035s # after: pip list (24.2) real\t0m0.207s user\t0m0.170s sys 0m0.036s On slower systems, the performance improvement will be greater.7 This uplift was achieved by optimizing pip‚Äôs importlib based metadata backend to read package8 names and versions from the installed metadata directory names.9 Previously, pip would read the name and version from the METADATA file, which is slow as it involves an extra file read and invoking an email header parser.\nOther optimizations Faster downloads PR #12810 @morotti Source distributions and wheels are downloaded in 256 KiB chunks instead of 10 KiB chunks, which significantly reduces overhead and enables faster download speeds. A sizable chunk (ü•Å) of the performance improvement comes from reducing the number of updates of the download progress bar. Faster dependency resolution PR #12663 @notatallshaw ‚Ä¶ of highly complex or pathological dependency trees. As pip‚Äôs dependency resolver explores a dependency tree, it has to parse requirements (e.g. pip==24.2) into a format it understands. In complex trees, the same requirements are often encountered many, many times. There was some caching in-place to minimize redundant work, but now requirements are consistently cached. Faster installation PR #12803 @morotti Wheels, which are really zip archives, are extracted using a larger block size (either 1MiB or the file size if it‚Äôs smaller than a MiB). Also, the zip decompressor is no longer invoked while copying empty files, eliminating pointless CPU cycles for files like __init__.py. Faster reinstalls PR #12755 yours truly! The full list of platform compatibility tags is now only generated once and reused across all look-ups of the wheel cache, speeding up cached reinstalls. pip check just got a bit stricter The check pip command now verifies whether installed packages are declared to support the current platform, issuing a warning if a package is incompatible.\npip check catboost 1.1.1 is not supported on this platform ninja 1.11.1.1 is not supported on this platform xgboost 1.6.1 is not supported on this platform frozendict 2.3.8 is not supported on this platform Under the hood, for every package, pip reads the WHEEL metadata file that‚Äôs installed alongside the package, and checks whether at least one of the compatibility tags is supported on the platform.\nFor example, this is the WHEEL file from pip 24.2‚Äôs wheel:\n# pip-24.2.dist-info/WHEEL Wheel-Version: 1.0 Generator: setuptools (71.1.0) Root-Is-Purelib: true Tag: py3-none-any py3-none-any is a platform compatibility tag. What‚Äôs a compatibility tag? They‚Äôre essentially markers for what systems a package supports. You can think of them like languages. They include information on the architecture, Python ABI, and Python version. Every system has a set of compatibility tags it supports. If a package and the system it‚Äôs being installed to share a common tag‚Äîor with the analogy, speak a shared language‚Äîthe package is considered compatible.\nIn this case, py3-none-any is code for ‚Äúany Python 3 version‚Äù, ‚Äúany Python ABI‚Äù, and ‚Äúany architecture.‚Äù This is supported by any modern Python installation, thus this wheel would be almost always eligible for installation (although it may be rejected for other reasons, like requires-python restrictions).\nNow, pip install already uses compatibility tags to ensure it only installs compatible packages. This extra check in pip check is designed to surface packages that were compatible at the time of installation, but are no longer supported due to a system upgrade. This is possible, especially as Apple transitions from the x86-64 architecture (Intel) to arm64 (Apple Silicon).\n(Un)fortunately, this has had the side-effect of revealing numerous packages with inaccurate or outright malformed metadata, leading to false positives. This is annoying, but regarded as an intentional side-effect as the pip project has been moving towards enforcing standards compliance so pip follows the standards instead of de facto writing them.10\nThis was kindly contributed by @q0w.\nOh yeah, --require-virtualenv is a thing You can configure pip to only function when running in an activated virtual environment via the --require-virtualenv flag. You can set this via a system-side or user-side configuration file; and it‚Äôs great for ensuring you don‚Äôt scribble all over your system or user Python environment.\npip install package-that-shouldnt-be-installed-system-wide ERROR: Could not find an activated virtualenv (required). Anyway, it‚Äôs supposed to only apply to commands that modify the environment, like pip install or pip uninstall. Read-only commands, such as pip list, are unaffected by the flag and will function even if a virtual environment is not activated.\nThis release extends this QoL feature to pip check and pip index. You can now discover unsupported packages whenever you want. Thanks @branchvincent!\nSummary pip 24.2 delivers considerable performance and QoL improvements. It also continues the pip project‚Äôs goal of following and enforcing the use of and compliance with the interoperatability standards that have shaped modern Python packaging.\nI realize that this post is long, but this release contained some cool changes and I believed they deserved more attention than a brief entry in the changelog. I make no promises that I‚Äôll continue this series for future pip releases, but this sure was fun to write!\nFinally, I‚Äôd like to thank Bartosz Sokorski, Bradley Reynolds, Hugo van Kemenade, and Paul Moore for reviewing this post in draft form and suggesting improvements. Any mistakes are of course my own.\nPoetry is the all encompassing user-facing tool for packaging and dependency management, while poetry-core is its backend. The same nitpick exists for all other ‚Äúbackends‚Äù I mention.¬†‚Ü©Ô∏é\nIn reality, pip calls other hooks as well to query additional build dependencies and generate metadata, but this isn‚Äôt the post where I explain pip‚Äôs entire PEP 517 implementation.¬†‚Ü©Ô∏é\n--no-build-isolation may be needed if the project has build-time requirements beyond setuptools and wheel. By passing this flag, you are responsible for making sure your environment already has the required dependencies to build your package.¬†‚Ü©Ô∏é\nAs of writing, the TL;DR is that strict editables are implemented as a tree of file links to the original source files in an auxiliary directory which is then added to sys.path, while legacy ‚Äúcompat mode‚Äù editables are implemented by placing the entire root of your package on sys.path. The new method is designed to ensure only files present at installation are exposed, mimicking a normal installation. It‚Äôs rather neat that setuptools has support for all three methods described for implementing an editable install in PEP 660.¬†‚Ü©Ô∏é\nThis was recognized as a problem in 2014, and pip gained the ability to use system certificates on Unix in 2015, but this change was later reverted because it turned out none of the major distributions had a functional OpenSSL configuration at the time.¬†‚Ü©Ô∏é\npip continues to use truststore in tandem with certifi. This is necessary for platforms that do not support truststore, but also provides a fallback if the system trust store is broken or otherwise inaccessible for some reason. There are currently no plans for pip to switch to exclusively use truststore.¬†‚Ü©Ô∏é\nAlso, it‚Äôs worth mentioning that 3/4 of the 200ms is taken by Python‚Äôs own startup overhead and importing everything pip list needs.¬†‚Ü©Ô∏é\nOK, so technically I should be saying ‚Äúdistribution‚Äù to avoid ambiguity as the term ‚Äúpackage‚Äù means something different under the Python import system, but distribution sounds weird which is why I‚Äôm saying ‚Äúpackage‚Äù still. I‚Äôm horribly inconsistent about this though.¬†‚Ü©Ô∏é\nIf you dig into your site-packages directory, you‚Äôll notice that there is a bunch of -.dist-info directories. These contain package metadata, and there is one for each package installed. They are included in wheels and are copied during installation.¬†‚Ü©Ô∏é\nHistorically, as pip was the only installer in town, various bits of pip‚Äôs design or behaviour has been become de facto standards. Even if there is a standard, ‚Äúpip supports X‚Äù or ‚Äúpip does X‚Äù can be regularly seen in the issue trackers of other packaging tools. While this is expected and unavoidable, it‚Äôs unideal. We don‚Äôt want to be in the business of telling what everyone else should be doing, especially as pip is old and has quirks and design flaws that frankly shouldn‚Äôt exist, let alone be copied by other tools. By gradually enforcing standards compliance, the Python packaging ecosystem becomes more and more defined by common specifications, allowing other packaging tools to function without reimplementing a bunch of pip bugs or whatever.¬†‚Ü©Ô∏é\n","wordCount":"3071","inLanguage":"en-ca","datePublished":"2024-08-26T00:00:00-04:00","dateModified":"2024-08-29T00:00:00-04:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ichard26.github.io/blog/2024/08/whats-new-in-pip-24.2/"},"publisher":{"@type":"Person","name":"Richard Si","logo":{"@type":"ImageObject","url":"https://ichard26.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ichard26.github.io/ accesskey=h title="Richard Si (Alt + H)">Richard Si</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ichard26.github.io/about/ title=About><span>about</span></a></li><li><a href=https://ichard26.github.io/blog/ title=Writing><span>writing</span></a></li><li><a href=https://ichard26.github.io/privacy/ title="Privacy Statement"><span>privacy</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">What's new in pip 24.2 ‚Äî or why legacy editable installs are deprecated</h1><div class=post-description>In version 24.2, pip learns to use system certificates by default, receives a handful of optimizations, and deprecates legacy (setup.py develop) editable installations.</div><div class=post-meta><span class=post-date title='Posted on 2024-08-26 00:00:00 -0400 EDT'>August 26, 2024</span><span class=delimiter>&nbsp;¬∑&nbsp;</span><span class=last-modified title='Updated on 2024-08-29 00:00:00 -0400 EDT'>Updated on August 29, 2024</span><span class=delimiter>&nbsp;¬∑&nbsp;</span>15 minutes</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><ul><ul><li><a href=#psa-psa-psa- aria-label="PSA, PSA, PSA üì£">PSA, PSA, PSA üì£</a></li></ul></ul><li><a href=#legacy-editable-installs-are-deprecated aria-label="Legacy editable installs are deprecated">Legacy editable installs are deprecated</a><ul><li><a href=#ok-so-what-now aria-label="OK, so what now?">OK, so what now?</a></li></ul></li><li><a href=#system-https-certificates-by-default aria-label="System HTTPS certificates by default(*)">System HTTPS certificates by default(*)</a></li><li><a href=#performance-optimizations-duh aria-label="Performance optimizations, duh!">Performance optimizations, duh!</a><ul><li><a href=#faster-discovery-of-installed-packages aria-label="Faster discovery of installed packages">Faster discovery of installed packages</a></li><li><a href=#other-optimizations aria-label="Other optimizations">Other optimizations</a></li></ul></li><li><a href=#pip-check-just-got-a-bit-stricter aria-label="pip check just got a bit stricter">pip check just got a bit stricter</a></li><li><a href=#oh-yeah---require-virtualenv-is-a-thing aria-label="Oh yeah, --require-virtualenv is a thing">Oh yeah, --require-virtualenv is a thing</a></li><li><a href=#summary aria-label=Summary>Summary</a></li></ul></div></details></div><div class=post-content><p>On July 28, 2024, the pip team released <a href=https://discuss.python.org/t/announcement-pip-24-2-release/59402 target=_blank>pip 24.2</a>. As a recent addition to the pip core
team, I&rsquo;ll walk you through the noteworthy or interesting changes from pip 24.2. Let&rsquo;s go!</p><blockquote><h4 id=psa-psa-psa->PSA, PSA, PSA üì£<a hidden class=anchor aria-hidden=true href=#psa-psa-psa->#</a></h4><p>If you&rsquo;re using setuptools, do not have a <code>pyproject.toml</code>, and use pip&rsquo;s <code>-e</code> flag, you
may be impacted by the <a href=https://github.com/pypa/pip/issues/11457 target=_blank>deprecation of legacy editable installs</a>.</p><p>If you&rsquo;re an user of setuptools and came to this post after seeing the legacy editable
install deprecation warning,
<a href=https://github.com/pypa/pip/issues/11457 target=_blank>you should first read the deprecation issue for solutions, <strong>not here</strong></a>.</p><p>You can come back and read this after for more historical context on the deprecation,
however! It&rsquo;s a good read, I promise.</p></blockquote><p>Here&rsquo;s a <a href=https://pip.pypa.io/en/stable/news/#v24-2 target=_blank>link to the 24.2 changelog</a> if you&rsquo;d like the full list of changes.</p><h2 id=legacy-editable-installs-are-deprecated>Legacy editable installs are deprecated<a hidden class=anchor aria-hidden=true href=#legacy-editable-installs-are-deprecated>#</a></h2><blockquote><p>TL;DR, <strong>don&rsquo;t panic</strong>. The <code>-e</code> option is <em>not</em> deprecated, but the way it works under
the hood will change, potentially necessitating changes to how your project is packaged.</p></blockquote><p>Over the last decade, there has been a major transition towards <strong>standardized
mechanisms</strong> for packaging Python projects:</p><ul><li><strong><a href=https://peps.python.org/pep-0517/ target=_blank>PEP 517</a></strong>: introduced an interface where frontends (e.g. the pip installer) can
interact with a build backend (e.g. Poetry<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>), including asking it to build a
wheel for later installation</li><li><strong><a href=https://peps.python.org/pep-0518/ target=_blank>PEP 518</a></strong>: introduced <code>pyproject.toml</code> and defined a standard format for declaring
build-time dependencies using this file</li><li><strong><a href=https://peps.python.org/pep-0621/ target=_blank>PEP 621</a></strong>: defined a standard format for declaring project metadata in
<code>pyproject.toml</code></li><li><strong><a href=https://peps.python.org/pep-0660/ target=_blank>PEP 660</a></strong>: augmented the PEP 517 interface to define a way to ask a build backend to
prepare an editable install</li></ul><p>These PEPs are what enable the use of alternative backends like <a href=https://python-poetry.org/ target=_blank>Poetry</a>, <a href=https://hatch.pypa.io/latest/ target=_blank>Hatch</a>, and
<a href=https://scikit-build-core.readthedocs.io/ target=_blank>scikit-build-core</a> <em>without needing to add specific support for each backend</em> in every
frontend (e.g. pip, tox, uv). Instead of running <code>setup.py bdist_wheel</code> to ask setuptools
to build a wheel for installation, pip can simply call the <code>build_wheel</code>
hook<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> from PEP 517 which all backends are guaranteed to have.</p><p>As each standard matured, <strong>pip has progressively deprecated and removed support for
legacy</strong> (and often setuptools-specific) <strong>mechanisms</strong> to reduce technical debt and
ensure that pip can continue to evolve.</p><p>Editable installs‚Äîthe thing you get from <code>pip install -e &lt;path></code>‚Äîused to be a setuptools
only feature, requiring pip to call the project&rsquo;s <code>setup.py</code> with the <code>develop</code>
sub-command. However, this stopped being the case under <a href=https://peps.python.org/pep-0660/ target=_blank>PEP 660</a>. As long as your
project&rsquo;s backend supports PEP 660, <code>pip install -e</code> will continue to work. No setuptools
required. (Although modern setuptools works fine as well.)</p><h3 id=ok-so-what-now>OK, so what now?<a hidden class=anchor aria-hidden=true href=#ok-so-what-now>#</a></h3><p>This release,
<a href=https://github.com/pypa/pip/issues/11457 target=_blank>pip has deprecated support for the <code>setup.py develop</code> fallback</a>
which is used when a project lacks support for modern editable installs. <strong>It will be
removed in pip 25.0 (Q1 2025)</strong> after which projects MUST support PEP 660 to perform an
editable install. Affected projects will see this deprecation warning:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-console data-lang=console><span style=display:flex><span>pip install -e temp/pip-test-package
</span></span><span style=display:flex><span>Obtaining file:///home/ichard26/dev/oss/pip/temp/pip-test-package
</span></span><span style=display:flex><span>  Preparing metadata (setup.py) ... done
</span></span><span style=display:flex><span>Installing collected packages: version_pkg
</span></span><span style=display:flex;background-color:#3c3d38><span>  DEPRECATION: Legacy editable install of version_pkg==0.1 from file:///home/ichard26/dev/oss/pip/temp/pip-test-package (setup.py develop) is deprecated. pip 25.0 will enforce this behaviour change. A possible replacement is to add a pyproject.toml or enable --use-pep517, and use setuptools &gt;= 64. If the resulting installation is not behaving as expected, try using --config-settings editable_mode=compat. Please consult the setuptools documentation for more information. Discussion can be found at https://github.com/pypa/pip/issues/11457
</span></span><span style=display:flex><span>  Running setup.py develop for version_pkg
</span></span><span style=display:flex><span>Successfully installed version_pkg-0.1
</span></span></code></pre></div><p>In practice, this usually means one of two things:</p><ul><li>The <code>pyproject.toml</code> file doesn&rsquo;t exist at all, thus pip will opt-out of the PEP 517
interface, running <code>setup.py</code> as required</li><li>The declared setuptools version (in the <code>[build-system].requires</code> field) is too old and
doesn&rsquo;t support PEP 660, i.e. anything older than <a href=https://setuptools.pypa.io/en/latest/history.html#v64-0-0 target=_blank>setuptools 64.0.0</a></li></ul><p>For affected projects, the best solution is likely to <strong>use a modern version of setuptools
and declare this via <code>pyproject.toml</code></strong>. You can place your project metadata in this file
as well, but it&rsquo;s <em>not</em> required to stop the legacy editable deprecation warnings.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#75715e># pyproject.toml</span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>build-system</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>requires</span> = [<span style=color:#e6db74>&#34;setuptools &gt;= 64&#34;</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>build-backend</span> = <span style=color:#e6db74>&#34;setuptools.build_meta&#34;</span>
</span></span></code></pre></div><blockquote><p><strong>Tip</strong>: if you have other dependencies needed to run <code>setup.py</code> or otherwise build your
package, you should add them to the <code>["setuptools >= 64"]</code> list. This field is
equivalent to setuptools&rsquo; <code>setup_requires</code> parameter.</p></blockquote><p>Alternatively, projects can pass the <code>--enable-pep517</code> flag to force pip to use the PEP
517 interface, including the editable install extensions from PEP 660. If no backend is
declared, pip will assume that the project uses setuptools and ensure it&rsquo;s available in
the isolated build environment.<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> As long as setuptools 64+ still supports your
Python version, a modern editable install will be performed. Once the legacy mechanism is
removed, <code>--use-pep517</code> will have no effect and will essentially be enabled by default.</p><p>Finally, if you don&rsquo;t like either of those solutions, you can always throw away setuptools
and switch to a different backend entirely. I&rsquo;ve mentioned a few earlier, but there are
even more options to choose from if you&rsquo;re willing to do some research and play around.
I&rsquo;d start with with the
<a href=https://packaging.python.org/en/latest/guides/tool-recommendations/#build-backends target=_blank>Python Packaging User Guide&rsquo;s list of the commonly used backends</a> if you want
to replace setuptools.</p><p>If you stick with setuptools, one potential snag is that setuptools has introduced a new
kind of editable installs while rolling out PEP 660 by default:</p><ul><li>If a package uses the &ldquo;src&rdquo; layout or otherwise places the source code in a separate
top-level directory, setuptools will create a static <code>.pth</code> file to extend the Python
import path with that directory</li><li>If a package uses the &ldquo;flat&rdquo; layout, setuptools will install a custom import hook which
intercepts imports and &ldquo;redirects&rdquo; them to the original modules (so auxiliary top-level
files like <code>noxfile.py</code> or <code>setup.py</code> or a <code>tests</code> package aren&rsquo;t importable)</li></ul><p>If the <a href=https://setuptools.pypa.io/en/latest/userguide/development_mode.html#legacy-behavior target=_blank>legacy behaviour is desired</a>, one must pass
<code>--config-settings editable_mode=compat</code>. There is also one more method:
<a href=https://setuptools.pypa.io/en/latest/userguide/development_mode.html#strict-editable-installs target=_blank>strict editable installs</a>. They behave closer to a normal installation, but are
implemented in an entirely different way from <code>setup.py</code> or the default method described
above.<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup></p><p><em>(<strong>Update</strong>: a setuptools maintainer reached out to strict editable installs are not
enabled by default. It turns out that the situation behind potential breakage is a bit
more nuanced. Sorry!)</em></p><blockquote><p><strong>Warning</strong>: Static analysis tools including mypy, pyright, and pylint may not function
properly when setuptools uses an import hook to implement an editable install.
<a href=https://github.com/pypa/setuptools/issues/3518 target=_blank>This is a known issue</a>. The recommended workaround is to pass
<code>--config-settings editable_mode=compat</code>.</p></blockquote><p>For more details using setuptools with <code>pyproject.toml</code>, you should read their
documentation:</p><ul><li>‚≠ê <a href=https://setuptools.pypa.io/en/latest/userguide/pyproject_config.html target=_blank>User guide to using <code>pyproject.toml</code></a> ‚≠ê</li><li>‚≠ê <a href=https://setuptools.pypa.io/en/latest/userguide/development_mode.html target=_blank>setuptools&rsquo; editable install docs</a> ‚≠ê</li><li><a href=https://setuptools.pypa.io/en/latest/build_meta.html target=_blank>setuptools&rsquo; build system docs</a></li></ul><p>If you&rsquo;d like to learn more, especially about the history of why and how these standards
came to exist, <strong>I strongly recommend
<a href=https://blog.ganssle.io/articles/2021/10/setup-py-deprecated.html target=_blank>reading Paul Ganssle&rsquo;s excellent &ldquo;Why you shouldn&rsquo;t invoke setup.py directly&rdquo; article</a></strong>.
It&rsquo;s <em>long</em>, but packs way more information than I could ever <em>hope</em> to cover.</p><h2 id=system-https-certificates-by-default>System HTTPS certificates by default(*)<a hidden class=anchor aria-hidden=true href=#system-https-certificates-by-default>#</a></h2><p>If you&rsquo;ve ever used pip in a corporate environment, there is a good chance that you&rsquo;ve
encountered a network or SSL verification error because the remote index server (PyPI or a
private index) returned a HTTPS certificate that couldn&rsquo;t be verified.</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-console data-lang=console><span style=display:flex><span>pip install toto
</span></span><span style=display:flex><span>Looking in indexes: https://repos.company/api/pypi/python_pypi/simple
</span></span><span style=display:flex><span>WARNING: Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by &#39;SSLError(SSLError(0, &#39;unknown error (_ssl.c:3630)&#39;),)&#39;: /api/pypi/python_pypi/simple/toto/
</span></span><span style=display:flex><span>WARNING: Retrying (Retry(total=3, connect=None, read=None, redirect=None, status=None)) after connection broken by &#39;SSLError(SSLError(0, &#39;unknown error (_ssl.c:3630)&#39;),)&#39;: /api/pypi/python_pypi/simple/toto/
</span></span><span style=display:flex><span>WARNING: Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by &#39;SSLError(SSLError(0, &#39;unknown error (_ssl.c:3630)&#39;),)&#39;: /api/pypi/python_pypi/simple/toto/
</span></span><span style=display:flex><span>WARNING: Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by &#39;SSLError(SSLError(0, &#39;unknown error (_ssl.c:3630)&#39;),)&#39;: /api/pypi/python_pypi/simple/toto/
</span></span><span style=display:flex><span>WARNING: Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by &#39;SSLError(SSLError(0, &#39;unknown error (_ssl.c:3630)&#39;),)&#39;: /api/pypi/python_pypi/simple/toto/
</span></span><span style=display:flex;background-color:#3c3d38><span>Could not fetch URL https://repos.company/api/pypi/python_pypi/simple/toto/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host= &#39;repos.company&#39;, port=443): Max retries exceeded with url: /api/pypi/python_pypi/simple/toto/ (Caused by SSLError(SSLError(0, &#39;unknown error (_ssl.c:3630)&#39;),)) - skipping
</span></span><span style=display:flex><span>ERROR: Could not find a version that satisfies the requirement toto (from versions: none)
</span></span><span style=display:flex><span>ERROR: No matching distribution found for toto
</span></span></code></pre></div><p>The problem is that while your system may be configured with the required certificate
authorities, <em>pip had no ability to use those system CAs</em>. This resulted in a confusing
user experience, because while your browser was likely able to access the index server,
pip <a href=https://github.com/pypa/pip/issues/12560 target=_blank>blew up</a> with a non-obvious <a href=https://github.com/pypa/pip/issues/10777 target=_blank>error</a>.</p><p>To be able to verify HTTPS certificates, since the early days, pip has shipped with the
<a href=https://pypi.org/project/certifi/ target=_blank>certifi</a> CA bundle, which is simply a Python repackaging of the Mozilla CA bundle. To get
pip to verify HTTPS certificates not trusted by certifi, you had to pass your own bundle
via the <code>--cert</code> option which is clunky.</p><p>In pip 22.2, pip gained the ability to use <a href=https://pypi.org/project/truststore/ target=_blank>truststore</a> for HTTPS certificate validation,
enabling pip to use the system certificate store instead of solely relying on certifi. The
integration was experimental; users had to have truststore already installed and opt-in
via <code>--use-feature=truststore</code>, but it was a step forward.<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup> The plan was to enable
truststore by default once the feature matured.</p><p>Two years later, in this pip release, <strong>truststore is now enabled by default</strong>.<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>
Thus, assuming your system is configured properly with the required CAs, pip should simply
&ldquo;just work&rdquo; even in many corporate environments. üéâ</p><p>There is one major problem though‚Äîyou saw that asterisk, right? <strong>Truststore only works on
Python 3.10 or higher</strong>. pip will continue to exclusively use its certifi bundle on Python
3.9 or 3.8. Additionally,
<a href=https://github.com/pypa/pip/issues/12892 target=_blank>any Python implementation that does not implement the <code>ssl</code> module APIs needed by truststore</a>
will not be able to use the system trust store either. In these situations, you will need
to continue using <code>--cert</code>.</p><p>Major thanks goes to <a href=https://sethmlarson.dev/ target=_blank>@sethmlarson</a> for co-authoring truststore and writing patches
improving and fixing pip&rsquo;s truststore integration!</p><h2 id=performance-optimizations-duh>Performance optimizations, duh!<a hidden class=anchor aria-hidden=true href=#performance-optimizations-duh>#</a></h2><p>In this release, several optimizations of the environment inspection, file download,
dependency resolution, and installation logic landed. While individually they are minor
optimizations, together they provide a noticeable performance uplift in a variety of
workloads!</p><h3 id=faster-discovery-of-installed-packages>Faster discovery of installed packages<a hidden class=anchor aria-hidden=true href=#faster-discovery-of-installed-packages>#</a></h3><p>First of all, on Python 3.11 or higher, pip is significantly faster to discover installed
packages (especially if there are a lot of &rsquo;em). This not only makes <code>pip list</code> faster,
but also makes pip generally faster as it has to figure out what packages are already
installed <a href=https://github.com/pypa/pip/pull/12656#issuecomment-2097040577 target=_blank>quite frequently throughout its operation</a>.</p><p>These are the before and after runtimes of <code>pip list</code> in my pip development environment
which has 75 packages installed:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#75715e># before: pip list (24.1)</span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#a6e22e>real	0m0.227s</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>user	0m0.192s</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sys 	0m0.035s</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#75715e># after: pip list (24.2)</span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#a6e22e>real	0m0.207s</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>user	0m0.170s</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sys 	0m0.036s</span>
</span></span></code></pre></div><p>On slower systems, the performance improvement will be greater.<sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup> This
uplift was achieved by optimizing pip&rsquo;s <code>importlib</code> based metadata backend to read
package<sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup> names and versions from the installed metadata directory
names.<sup id=fnref:9><a href=#fn:9 class=footnote-ref role=doc-noteref>9</a></sup> Previously, pip would read the name and version from the
<a href=https://packaging.python.org/en/latest/specifications/recording-installed-packages/#the-metadata-file target=_blank><code>METADATA</code> file</a>, which is slow as it involves an extra file read and invoking an email
header parser.</p><h3 id=other-optimizations>Other optimizations<a hidden class=anchor aria-hidden=true href=#other-optimizations>#</a></h3><dl><dt>Faster downloads <em><a href=https://github.com/pypa/pip/pull/12810 target=_blank>PR #12810</a></em> <em>@morotti</em></dt><dd>Source distributions and wheels are downloaded in 256 KiB chunks instead of 10 KiB
chunks, which significantly reduces overhead and enables faster download speeds. A
sizable <em>chunk</em> (ü•Å) of the performance improvement comes from reducing the number of
updates of the download progress bar.</dd><dt>Faster dependency resolution <em><a href=https://github.com/pypa/pip/pull/12663 target=_blank>PR #12663</a></em> <em>@notatallshaw</em></dt><dd>&mldr; of highly complex or pathological dependency trees. As pip&rsquo;s dependency resolver
explores a dependency tree, it has to parse requirements (e.g. <code>pip==24.2</code>) into a
format it understands. In complex trees, the same requirements are often encountered
many, <em>many</em> times. There was <em>some</em> caching in-place to minimize redundant work, but
now requirements are consistently cached.</dd><dt>Faster installation <em><a href=https://github.com/pypa/pip/pull/12803 target=_blank>PR #12803</a></em> <em>@morotti</em></dt><dd>Wheels, <a href=https://packaging.python.org/en/latest/specifications/binary-distribution-format/ target=_blank>which are really zip archives</a>, are extracted using a larger block size (either
1MiB or the file size if it&rsquo;s smaller than a MiB). Also, the zip decompressor is no
longer invoked while copying empty files, eliminating pointless CPU cycles for files
like <code>__init__.py</code>.</dd><dt>Faster reinstalls <em><a href=https://github.com/pypa/pip/pull/12755 target=_blank>PR #12755</a></em> <em>yours truly!</em></dt><dd>The full list of platform compatibility tags is now only generated once and reused
across all look-ups of the wheel cache, speeding up cached reinstalls.</dd></dl><h2 id=pip-check-just-got-a-bit-stricter><code>pip check</code> just got a bit stricter<a hidden class=anchor aria-hidden=true href=#pip-check-just-got-a-bit-stricter>#</a></h2><p>The <code>check</code> pip command now verifies whether installed packages are declared to support
the current platform, issuing a warning if a package is incompatible.</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>pip check
</span></span><span style=display:flex><span>catboost 1.1.1 is not supported on this platform
</span></span><span style=display:flex><span>ninja 1.11.1.1 is not supported on this platform
</span></span><span style=display:flex><span>xgboost 1.6.1 is not supported on this platform
</span></span><span style=display:flex><span>frozendict 2.3.8 is not supported on this platform
</span></span></code></pre></div><p>Under the hood, for every package, pip reads the <code>WHEEL</code> metadata file that&rsquo;s installed
alongside the package, and checks whether at least one of the compatibility tags is
supported on the platform.</p><p>For example, this is the <code>WHEEL</code> file from pip 24.2&rsquo;s wheel:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># pip-24.2.dist-info/WHEEL</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Wheel-Version</span>: <span style=color:#ae81ff>1.0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Generator</span>: <span style=color:#ae81ff>setuptools (71.1.0)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Root-Is-Purelib</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Tag</span>: <span style=color:#ae81ff>py3-none-any</span>
</span></span></code></pre></div><p><code>py3-none-any</code> is a platform compatibility tag. What&rsquo;s a compatibility tag?
<a href=https://packaging.python.org/en/latest/specifications/platform-compatibility-tags/ target=_blank>They&rsquo;re essentially markers for what systems a package supports.</a> You can
think of them like languages. They include information on the architecture, Python ABI,
and Python version. Every system has a set of compatibility tags it supports. If a package
and the system it&rsquo;s being installed to share a common tag‚Äîor with the analogy, <em>speak a
shared language</em>‚Äîthe package is considered compatible.</p><p>In this case, <code>py3-none-any</code> is code for &ldquo;any Python 3 version&rdquo;, &ldquo;any Python ABI&rdquo;, and
&ldquo;any architecture.&rdquo; This is supported by any modern Python installation, thus this wheel
would be almost always eligible for installation (although it may be rejected for other
reasons, like <code>requires-python</code> restrictions).</p><p>Now, <code>pip install</code> already uses compatibility tags to ensure it only installs compatible
packages. This extra check in <code>pip check</code> is designed to surface packages that were
<strong>compatible at the time of installation, but are no longer supported due to a system
upgrade</strong>. This is possible, especially as
<a href=https://github.com/pypa/pip/issues/11054 target=_blank>Apple transitions from the <code>x86-64</code> architecture (Intel) to <code>arm64</code> (Apple Silicon)</a>.</p><p>(Un)fortunately, this has had the side-effect of
<a href=https://github.com/pypa/pip/issues/12884 target=_blank>revealing numerous packages with inaccurate or outright malformed metadata, leading to false positives</a>.
This is annoying, but regarded as an intentional side-effect as the pip project has been
moving towards enforcing standards compliance so pip follows the standards instead of de
facto writing them.<sup id=fnref:10><a href=#fn:10 class=footnote-ref role=doc-noteref>10</a></sup></p><p>This was <a href=https://github.com/pypa/pip/pull/11088 target=_blank>kindly contributed by @q0w</a>.</p><h2 id=oh-yeah---require-virtualenv-is-a-thing>Oh yeah, <code>--require-virtualenv</code> is a thing<a hidden class=anchor aria-hidden=true href=#oh-yeah---require-virtualenv-is-a-thing>#</a></h2><p>You can configure pip to only function when running in an activated virtual environment
via the <code>--require-virtualenv</code> flag. You can set this via a system-side or user-side
configuration file; and it&rsquo;s great for ensuring you don&rsquo;t scribble all over your system or
user Python environment.</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>pip install package-that-shouldnt-be-installed-system-wide
</span></span><span style=display:flex><span>ERROR: Could not find an activated virtualenv (required).
</span></span></code></pre></div><p>Anyway, it&rsquo;s <em>supposed</em> to only apply to commands <strong>that modify the environment</strong>, like
<code>pip install</code> or <code>pip uninstall</code>. Read-only commands, such as <code>pip list</code>, are unaffected
by the flag and will function even if a virtual environment is not activated.</p><p>This release extends this QoL feature to <code>pip check</code> and <code>pip index</code>. You can now discover
unsupported packages whenever you want. <a href=https://github.com/pypa/pip/pull/12842 target=_blank>Thanks @branchvincent</a>!</p><h2 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2><p>pip 24.2 delivers considerable performance and QoL improvements. It also continues the pip
project&rsquo;s goal of following and enforcing the use of and compliance with the
interoperatability standards that have shaped modern Python packaging.</p><p>I realize that this post is long, but this release contained some cool changes and I
believed they deserved more attention than a brief entry in the changelog. I make no
promises that I&rsquo;ll continue this series for future pip releases, but this sure was fun to
write!</p><p>Finally, I&rsquo;d like to thank Bartosz Sokorski, Bradley Reynolds, Hugo van Kemenade, and Paul
Moore for reviewing this post in draft form and suggesting improvements. Any mistakes are
of course my own.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Poetry is the all encompassing user-facing tool for packaging and dependency
management, while <code>poetry-core</code> is its backend. The same nitpick exists for all other
&ldquo;backends&rdquo; I mention.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>In reality, pip calls other hooks as well to query additional build dependencies and
generate metadata, but this isn&rsquo;t the post where I explain pip&rsquo;s entire PEP 517
implementation.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><code>--no-build-isolation</code> may be needed if the project has build-time requirements beyond
setuptools and wheel. By passing this flag, you are responsible for making sure your
environment already has the required dependencies to build your package.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>As of writing, the TL;DR is that strict editables are implemented as a tree of file
links to the original source files in an auxiliary directory which is then added to
<code>sys.path</code>, while legacy &ldquo;compat mode&rdquo; editables are implemented by placing the entire
root of your package on <code>sys.path</code>. The new method is designed to ensure only files
present at installation are exposed, mimicking a normal installation. It&rsquo;s rather neat
that setuptools has support for all three methods described for implementing an
editable install in PEP 660.&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>This <a href=https://github.com/pypa/pip/issues/1680 target=_blank>was recognized as a problem in 2014</a>, and pip gained the ability to
<a href=https://github.com/pypa/pip/pull/1866 target=_blank>use system certificates on Unix in 2015</a>, but this change was later
reverted because it turned out
<a href=https://github.com/pypa/pip/commit/c77d4ab55ed412a3b72d0b73f504e8ddec918683 target=_blank>none of the major distributions had a functional OpenSSL configuration at the time</a>.&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p>pip continues to use truststore in tandem with certifi. This is necessary for
platforms that do not support truststore, but also provides a fallback if the system
trust store is broken or otherwise inaccessible for some reason. There are currently
no plans for pip to switch to exclusively use truststore.&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p>Also, it&rsquo;s worth mentioning that 3/4 of the 200ms is taken by Python&rsquo;s own startup
overhead and importing everything <code>pip list</code> needs.&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8><p>OK, so technically I should be saying &ldquo;distribution&rdquo; to avoid ambiguity as the term
&ldquo;package&rdquo; means something different under the Python import system, but distribution
sounds weird which is why I&rsquo;m saying &ldquo;package&rdquo; still. I&rsquo;m horribly inconsistent about
this though.&#160;<a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:9><p>If you dig into your <code>site-packages</code> directory, you&rsquo;ll notice that there is a bunch of
<code>&lt;name>-&lt;version>.dist-info</code> directories. These contain package metadata, and there is
one for each package installed. They are included in wheels and are copied during
installation.&#160;<a href=#fnref:9 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:10><p>Historically, as pip was the only installer in town, various bits of pip&rsquo;s design or
behaviour has been become de facto standards. Even if there is a standard, &ldquo;pip
supports X&rdquo; or &ldquo;pip does X&rdquo; can be regularly seen in the issue trackers of other
packaging tools. While this is expected and unavoidable, it&rsquo;s unideal. We don&rsquo;t want
to be in the business of telling what everyone else should be doing, especially as pip
is old and has quirks and design flaws that frankly shouldn&rsquo;t exist, let alone be
copied by other tools. By gradually enforcing standards compliance, the Python
packaging ecosystem becomes more and more defined by <em>common specifications</em>, allowing
other packaging tools to function without reimplementing a bunch of pip bugs or
whatever.&#160;<a href=#fnref:10 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://ichard26.github.io/tags/pip/>pip</a></li><li><a href=https://ichard26.github.io/tags/release/>release</a></li><li><a href=https://ichard26.github.io/tags/deprecation/>deprecation</a></li></ul><nav class=paginav><a class=next href=https://ichard26.github.io/blog/2023/01/black-23.1.0/><span class=title>Older ¬ª</span><br><span>What's new in Black 23.1.0</span></a></nav></footer></article></main><footer class=footer><span>¬© 2022-present, Richard Si</span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>